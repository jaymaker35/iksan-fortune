<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµì‚° ë§›ì§‘ ì²˜ë°©ì „ - ë‹¥í„° ìµì‚°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            min-height: 100vh;
            color: white;
            -webkit-overflow-scrolling: touch; 
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        .loader {
            border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff;
            width: 24px; height: 24px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .custom-checkbox:checked { background-color: #4f46e5; border-color: #4f46e5; }
        #capture-area { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); position: relative; overflow: hidden; }
        
        /* Biorhythm Bar Animation */
        .progress-bar { transition: width 1.5s ease-in-out; }
    </style>
</head>
<body class="flex items-center justify-center p-4 min-h-screen">

    <div class="max-w-md w-full glass-panel rounded-2xl shadow-2xl overflow-hidden relative my-8">
        <div class="absolute top-0 left-0 w-32 h-32 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
        <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>

        <div class="relative z-10 p-6 sm:p-8">
            <!-- Header (Updated Title & Icon) -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-green-500/20 mb-4 border border-green-500/30">
                    <!-- Stethoscope Icon for Prescription Concept -->
                    <i data-lucide="stethoscope" class="w-8 h-8 text-green-400"></i>
                </div>
                <h1 class="text-2xl font-bold mb-2">ìµì‚° ë§›ì§‘ ì²˜ë°©ì „</h1>
                <p class="text-gray-300 text-sm">ë°”ì´ì˜¤ë¦¬ë“¬ìœ¼ë¡œ ì§„ë‹¨í•˜ëŠ” ë‚˜ë§Œì˜ ë©”ë‰´</p>
            </div>

            <div id="input-section" class="space-y-5 transition-all duration-300">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">í™˜ì(?) ì„±í•¨</label>
                        <input type="text" id="username" placeholder="ì´ë¦„ ì…ë ¥" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">ìƒë…„ì›”ì¼ (ì§„ë‹¨ í•„ìˆ˜ ì •ë³´)</label>
                        <input type="date" id="birthdate" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 text-white placeholder-gray-400 appearance-none" required>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="remember-me" class="w-4 h-4 rounded border-gray-300 text-green-600 focus:ring-green-500 custom-checkbox">
                        <label for="remember-me" class="text-sm text-gray-400 cursor-pointer">ë‚´ ì§„ë£Œ ì •ë³´ ê¸°ì–µí•˜ê¸°</label>
                    </div>
                </div>
                
                <button onclick="startAnalysis()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl transition duration-300 flex items-center justify-center gap-2 mt-2 shadow-lg shadow-green-500/30">
                    <span id="btn-text">ë‚´ ëª¸ ìƒíƒœ ì§„ë‹¨í•˜ê³  ì²˜ë°©ë°›ê¸°</span>
                    <div id="btn-loader" class="loader hidden"></div>
                </button>
            </div>

            <div id="result-section" class="hidden space-y-6 pt-2">
                
                <!-- ìº¡ì²˜ ì˜ì—­ -->
                <div id="capture-area" class="p-6 rounded-xl border border-white/10 shadow-2xl space-y-5">
                    
                    <!-- ë‚ ì”¨ -->
                    <div class="flex items-center justify-between bg-white/10 p-4 rounded-xl border border-white/10 backdrop-blur-sm">
                        <div class="flex items-center gap-3">
                            <span id="weather-icon" class="text-3xl filter drop-shadow-md">â˜€ï¸</span>
                            <div>
                                <p class="text-xs text-indigo-200 mb-0.5">í˜„ì¬ ìµì‚° ë‚ ì”¨</p>
                                <p id="weather-text" class="font-bold text-lg text-white">ë§‘ìŒ, 22Â°C</p>
                            </div>
                        </div>
                        <div class="text-right border-l border-white/20 pl-4">
                             <p class="text-[10px] text-gray-300">Prescription Date</p>
                             <p id="today-date" class="font-bold text-lg text-white">05.23</p>
                        </div>
                    </div>

                    <!-- ë°”ì´ì˜¤ë¦¬ë“¬ ë¶„ì„ ê²°ê³¼ -->
                    <div class="space-y-4">
                        <div class="flex items-center gap-2 mb-1">
                            <span id="zodiac-icon" class="text-2xl"></span>
                            <div>
                                <h2 id="user-greeting" class="font-bold text-white text-lg"></h2>
                                <p class="text-xs text-gray-400">ë‹˜ì˜ ë°”ì´ì˜¤ë¦¬ë“¬ ì§„ë‹¨ ì°¨íŠ¸</p>
                            </div>
                        </div>

                        <!-- ê·¸ë˜í”„ -->
                        <div class="space-y-3 bg-black/20 p-4 rounded-xl border border-white/5">
                            <!-- ì‹ ì²´ -->
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-green-300">ì‹ ì²´ (ì²´ë ¥/ë©´ì—­)</span>
                                    <span id="val-phy" class="font-bold">0%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div id="bar-phy" class="bg-green-500 h-2 rounded-full progress-bar" style="width: 0%"></div>
                                </div>
                            </div>
                            <!-- ê°ì„± -->
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-red-300">ê°ì„± (ê¸°ë¶„/ìŠ¤íŠ¸ë ˆìŠ¤)</span>
                                    <span id="val-emo" class="font-bold">0%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div id="bar-emo" class="bg-red-500 h-2 rounded-full progress-bar" style="width: 0%"></div>
                                </div>
                            </div>
                            <!-- ì§€ì„± -->
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-blue-300">ì§€ì„± (ë‘ë‡Œ/ì§‘ì¤‘ë ¥)</span>
                                    <span id="val-int" class="font-bold">0%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div id="bar-int" class="bg-blue-500 h-2 rounded-full progress-bar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ì¢…í•© ì½”ë©˜íŠ¸ -->
                        <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                            <p class="text-[10px] text-gray-400 mb-1">ğŸ©º ë‹¥í„° ìµì‚°ì˜ ì†Œê²¬</p>
                            <p id="fortune-text" class="text-gray-100 leading-relaxed text-sm font-medium"></p>
                        </div>
                    </div>

                    <!-- ë§›ì§‘ ì¶”ì²œ (ì²˜ë°©ì „ ì»¨ì…‰) -->
                    <div class="bg-green-500/10 rounded-xl p-4 border border-green-500/20 relative">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-white text-sm flex items-center gap-2">
                                <i data-lucide="pill" class="w-4 h-4 text-green-300"></i>
                                ì˜¤ëŠ˜ì˜ ë§›ì§‘ ì²˜ë°©
                            </h3>
                            <span id="food-reason-badge" class="text-[10px] bg-green-500/30 text-green-100 px-2 py-0.5 rounded-full font-medium">ì²˜ë°© ì™„ë£Œ</span>
                        </div>
                        <div>
                            <h4 id="food-name" class="text-lg font-bold text-green-200"></h4>
                            <p id="food-desc" class="text-xs text-gray-300 leading-relaxed mt-1"></p>
                        </div>
                        
                        <div class="mt-3 flex justify-end" data-html2canvas-ignore="true">
                            <button onclick="rerollFood()" class="text-xs text-green-200/70 hover:text-green-200 flex items-center gap-1 transition-colors">
                                <i data-lucide="refresh-ccw" class="w-3 h-3"></i> ë‹¤ë¥¸ ì²˜ë°© ë³´ê¸°
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì§€ë„ ì°¾ê¸° ë©”ë‰´ -->
                    <a id="food-map-link" href="#" target="_blank" class="flex items-center justify-center gap-2 w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-colors font-bold text-sm shadow-md mt-4" data-html2canvas-ignore="true">
                        <i data-lucide="map-pin" class="w-4 h-4"></i> ì²˜ë°© ì‹ë‹¹ ìœ„ì¹˜ ì°¾ê¸°
                    </a>
                    
                    <div class="text-center pt-2 mt-4 border-t border-white/5">
                        <p class="text-[10px] text-gray-400">ìµì‚° ë§›ì§‘ ì²˜ë°©ì „ by Dr.Iksan</p>
                    </div>
                </div> 
                <!-- ìº¡ì²˜ ì˜ì—­ ë -->

                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="shareResult()" class="col-span-1 py-3 bg-yellow-400 hover:bg-yellow-500 text-gray-900 rounded-xl transition-colors font-bold flex items-center justify-center gap-2 shadow-lg text-sm">
                        <i data-lucide="share-2" class="w-4 h-4"></i> ì²˜ë°©ì „ ê³µìœ 
                    </button>
                    <button onclick="saveAsImage()" id="save-btn" class="col-span-1 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition-colors font-bold flex items-center justify-center gap-2 shadow-lg text-sm">
                        <i data-lucide="download" class="w-4 h-4"></i> ì²˜ë°©ì „ ì €ì¥
                    </button>
                </div>

                <div class="pt-4 text-center border-t border-white/10">
                    <button onclick="resetApp()" class="text-sm text-gray-400 hover:text-white flex items-center justify-center gap-1 mx-auto transition-colors">
                        <i data-lucide="refresh-cw" class="w-3 h-3"></i> ë‹¤ë¥¸ ì‚¬ëŒ ì§„ë‹¨í•˜ê¸°
                    </button>
                </div>
            </div>

            <div class="mt-8 pt-4 border-t border-white/10 flex justify-between items-end text-xs text-gray-400">
                <div>
                    <p class="mb-1">Â© 2025 Dr. Iksan's Prescription</p>
                    <p>Powered by Biorhythm Algo</p>
                </div>
                <div class="flex items-center gap-1 bg-white/5 px-2 py-1 rounded-lg border border-white/5">
                    <span id="busuanzi_container_site_pv" style="display:none;">
                        <i data-lucide="users" class="w-3 h-3 inline text-indigo-300"></i>
                        <span class="ml-1"></span>
                        <span id="busuanzi_value_site_pv" class="font-bold text-indigo-200">...</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // [ë°ì´í„°] ìŒì‹ ë°ì´í„°
        const weatherFoods = {
            "rain": [
                { name: "ì „ì§‘ (íŒŒì „&ë§‰ê±¸ë¦¬)", query: "ìµì‚° ì „ì§‘ ë§›ì§‘", desc: "ë¹„ ì˜¤ëŠ” ë‚  íŠ¹íš¨ì•½! ì§€ê¸€ì§€ê¸€ íŒŒì „ì— ë§‰ê±¸ë¦¬ í•œ ì”." },
                { name: "ì–¼í°í•œ ì§¬ë½•", query: "ìµì‚° ì§¬ë½• ë§›ì§‘", desc: "ë¹„ ì˜¤ëŠ” ë‚ ì˜ ìš°ìš¸í•¨ì„ ë‚ ë ¤ë²„ë¦´ ì–¼í°í•œ êµ­ë¬¼ ì²˜ë°©." },
                { name: "ë¶€ëŒ€ì°Œê°œ", query: "ìµì‚° ë¶€ëŒ€ì°Œê°œ", desc: "ë¹—ì†Œë¦¬ì™€ í•¨ê»˜ ë“ëŠ” ë”°ëœ»í•œ êµ­ë¬¼ì´ í•„ìš”í•©ë‹ˆë‹¤." }
            ],
            "snow": [
                { name: "êµ°ê³ êµ¬ë§ˆ & ë¼ë–¼", query: "ìµì‚° êµ°ê³ êµ¬ë§ˆ ì¹´í˜", desc: "ì¶”ìœ„ì—” ë‹¬ì½¤í•œ ìµì‚° ê³ êµ¬ë§ˆì™€ ë”°ëœ»í•œ ë¼ë–¼ê°€ ìµœê³ ." },
                { name: "ì‚¬ê³¨ ë–¡ë§Œë‘êµ­", query: "ìµì‚° ë§Œë‘êµ­ ë§›ì§‘", desc: "ì–¼ì–´ë¶™ì€ ëª¸ì„ ë…¹ì—¬ì¤„ ë“ ë“ í•œ ì‚¬ê³¨ êµ­ë¬¼." }
            ],
            "hot": [
                { name: "ì‹œì›í•œ ëƒ‰ë©´", query: "ìµì‚° ëƒ‰ë©´ ë§›ì§‘", desc: "í­ì—¼ì£¼ì˜ë³´ ë°œë ¹! ë¨¸ë¦¬ê°€ ëµí•´ì§€ëŠ” ëƒ‰ë©´ ê¸´ê¸‰ ì²˜ë°©." },
                { name: "ì‚´ì–¼ìŒ ë§¥ì£¼", query: "ìµì‚° ì—­ì „í• ë¨¸ë‹ˆë§¥ì£¼", desc: "ì—´ëŒ€ì•¼ ì¦í›„êµ°ì—” ë¼›ì†ê¹Œì§€ ì‹œì›í•œ ë§¥ì£¼ í•œ ì”." }
            ]
        };

        const moodFoods = {
            "physical": [ // ì‹ ì²´ê°€ í˜ë“¤ ë•Œ (ë³´ì–‘ì‹)
                { name: "í™©ë“± ìœ¡íšŒë¹„ë¹”ë°¥", query: "ìµì‚° í™©ë“± ìœ¡íšŒë¹„ë¹”ë°¥", desc: "ì €í•˜ëœ ì²´ë ¥ì„ ëŒì–´ì˜¬ë ¤ì¤„ ê³ ë‹¨ë°± ìœ¡íšŒ ì²˜ë°©." },
                { name: "í•œë°© ì‚¼ê³„íƒ•", query: "ìµì‚° ì‚¼ê³„íƒ• ë§›ì§‘", desc: "ì§€ì¹œ ëª¸ì— í™œë ¥ì„ ë¶ˆì–´ë„£ì„ ëœ¨ëˆí•œ ë³´ì–‘ì‹." },
                { name: "ì¥ì–´êµ¬ì´", query: "ìµì‚° ì¥ì–´ ë§›ì§‘", desc: "ê¸‰ê²©í•œ ì²´ë ¥ ì €í•˜ì—” ìŠ¤í…Œë¯¸ë„ˆ ëíŒì™• ì¥ì–´ ì¶”ì²œ." }
            ],
            "emotional": [ // ê°ì„±ì´ í’ë¶€í•˜ê±°ë‚˜ ìš°ìš¸í•  ë•Œ (ë‹¬ë‹¬/ë§¤ì½¤)
                { name: "ë§¤ì½¤ ë‚™ì§€ë³¶ìŒ", query: "ìµì‚° ë‚™ì§€ë³¶ìŒ", desc: "ìŒ“ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ì—” í™”ëˆí•œ ë§¤ìš´ë§› ìš”ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤." },
                { name: "ë¶„ìœ„ê¸° ì¢‹ì€ ì™€ì¸ë°”", query: "ìµì‚° ì™€ì¸ë°”", desc: "í’ë¶€í•´ì§„ ê°ì„±ì„ ì±„ì›Œì¤„ ì™€ì¸ í•œ ì” ì²˜ë°©." },
                { name: "ìµì‚° ê³ êµ¬ë§ˆë¹µ", query: "ìµì‚° ê³ êµ¬ë§ˆë¹µ", desc: "ìš°ìš¸í•œ ê¸°ë¶„ì—” ë‹¬ì½¤í•˜ê³  ë¶€ë“œëŸ¬ìš´ ë””ì €íŠ¸ê°€ ì•½ì…ë‹ˆë‹¤." }
            ],
            "intellectual": [ // ë¨¸ë¦¬ë¥¼ ì“¸ ë•Œ (ê°€ë²¼ì›€/ì»¤í”¼)
                { name: "ë¸ŒëŸ°ì¹˜ ì¹´í˜", query: "ìµì‚° ë¸ŒëŸ°ì¹˜ ì¹´í˜", desc: "ë³µì¡í•œ ë¨¸ë¦¬ë¥¼ ì‹í˜€ì¤„ ì—¬ìœ ë¡œìš´ ë¸ŒëŸ°ì¹˜ íƒ€ì„." },
                { name: "ëª¨ë“¬ ì´ˆë°¥", query: "ìµì‚° ì´ˆë°¥ ë§›ì§‘", desc: "ë‘ë‡Œ íšŒì „ì„ ë„ìš¸ ê¹”ë”í•˜ê³  ë¶€ë‹´ ì—†ëŠ” ì˜¤ë©”ê°€3 ì²˜ë°©." },
                { name: "í•¸ë“œë“œë¦½ ì»¤í”¼", query: "ìµì‚° ë¡œìŠ¤í„°ë¦¬ ì¹´í˜", desc: "ì§‘ì¤‘ë ¥ì´ í•„ìš”í•  ë• í–¥ê¸‹í•œ ì¹´í˜ì¸ ì¶©ì „." }
            ]
        };

        const zodiacSigns = [
            { name: "ë¬¼ë³‘ìë¦¬", start: "01-20", end: "02-18", icon: "â™’" },
            { name: "ë¬¼ê³ ê¸°ìë¦¬", start: "02-19", end: "03-20", icon: "â™“" },
            { name: "ì–‘ìë¦¬", start: "03-21", end: "04-19", icon: "â™ˆ" },
            { name: "í™©ì†Œìë¦¬", start: "04-20", end: "05-20", icon: "â™‰" },
            { name: "ìŒë‘¥ì´ìë¦¬", start: "05-21", end: "06-21", icon: "â™Š" },
            { name: "ê²Œìë¦¬", start: "06-22", end: "07-22", icon: "â™‹" },
            { name: "ì‚¬ììë¦¬", start: "07-23", end: "08-22", icon: "â™Œ" },
            { name: "ì²˜ë…€ìë¦¬", start: "08-23", end: "09-22", icon: "â™" },
            { name: "ì²œì¹­ìë¦¬", start: "09-23", end: "10-22", icon: "â™" },
            { name: "ì „ê°ˆìë¦¬", start: "10-23", end: "11-22", icon: "â™" },
            { name: "ì‚¬ìˆ˜ìë¦¬", start: "11-23", end: "12-24", icon: "â™" },
            { name: "ì—¼ì†Œìë¦¬", start: "12-25", end: "01-19", icon: "â™‘" }
        ];

        let currentFoodList = [];
        let currentFoodIndex = 0;

        window.addEventListener('load', () => {
            const savedName = localStorage.getItem('fortune_name');
            const savedDate = localStorage.getItem('fortune_date');
            if (savedName) document.getElementById('username').value = savedName;
            if (savedDate) {
                document.getElementById('birthdate').value = savedDate;
                document.getElementById('remember-me').checked = true;
            }
            const today = new Date();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const date = today.getDate().toString().padStart(2, '0');
            document.getElementById('today-date').innerText = `${month}.${date}`;
        });

        // [í•µì‹¬] ë°”ì´ì˜¤ë¦¬ë“¬ ê³„ì‚° ë¡œì§
        function getBiorhythm(birthDate, targetDate) {
            const oneDay = 24 * 60 * 60 * 1000;
            const daysLived = Math.round((targetDate - birthDate) / oneDay);
            
            const physical = Math.round(Math.sin((2 * Math.PI * daysLived) / 23) * 100);
            const emotional = Math.round(Math.sin((2 * Math.PI * daysLived) / 28) * 100);
            const intellectual = Math.round(Math.sin((2 * Math.PI * daysLived) / 33) * 100);

            return { physical, emotional, intellectual };
        }

        async function startAnalysis() {
            const birthInput = document.getElementById('birthdate').value;
            const nameInput = document.getElementById('username').value.trim();
            
            if (!birthInput) { alert("ì •í™•í•œ ì§„ë‹¨ì„ ìœ„í•´ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

            if (document.getElementById('remember-me').checked) {
                localStorage.setItem('fortune_date', birthInput);
                localStorage.setItem('fortune_name', nameInput);
            } else {
                localStorage.removeItem('fortune_date');
                localStorage.removeItem('fortune_name');
            }

            toggleLoading(true);

            try {
                // ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸°
                const weatherRes = await fetch("https://api.open-meteo.com/v1/forecast?latitude=35.9483&longitude=126.9578&current_weather=true&timezone=Asia%2FSeoul");
                const weatherData = await weatherRes.json();
                await new Promise(resolve => setTimeout(resolve, 1500)); // ì—°ì¶œìš© ë”œë ˆì´

                processResult(weatherData.current_weather, birthInput, nameInput);

            } catch (error) {
                processResult(null, birthInput, nameInput);
            }
        }

        function processResult(weather, birthInput, nameInput) {
            // 1. ë‚ ì”¨ ì²˜ë¦¬
            let weatherCondition = "clear";
            let weatherTextStr = "ë§‘ìŒ";
            let weatherIconStr = "â˜€ï¸";
            let temp = 20;

            if (weather) {
                temp = weather.temperature;
                const code = weather.weathercode;
                if (code <= 3) {
                    weatherCondition = temp > 28 ? "hot" : "clear";
                    weatherTextStr = code === 0 ? "ë§‘ìŒ" : "êµ¬ë¦„";
                    weatherIconStr = code === 0 ? "â˜€ï¸" : "â›…";
                } else if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) {
                    weatherCondition = "rain";
                    weatherTextStr = "ë¹„";
                    weatherIconStr = "â˜”";
                } else if ((code >= 71 && code <= 86)) {
                    weatherCondition = "snow";
                    weatherTextStr = "ëˆˆ";
                    weatherIconStr = "â„ï¸";
                } else {
                    weatherCondition = "clear";
                    weatherTextStr = "íë¦¼";
                    weatherIconStr = "ğŸŒ«ï¸";
                }
            }
            document.getElementById('weather-text').innerText = `${weatherTextStr}, ${temp}Â°C`;
            document.getElementById('weather-icon').innerText = weatherIconStr;

            // 2. ë°”ì´ì˜¤ë¦¬ë“¬ ê³„ì‚°
            const birthDate = new Date(birthInput);
            const today = new Date();
            const bio = getBiorhythm(birthDate, today);

            // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
            updateBar('phy', bio.physical);
            updateBar('emo', bio.emotional);
            updateBar('int', bio.intellectual);

            // ë©˜íŠ¸ ìƒì„± ë¡œì§
            let fortuneMsg = "";
            let recommendType = "intellectual"; // Default
            
            const maxVal = Math.max(bio.physical, bio.emotional, bio.intellectual);
            const minVal = Math.min(bio.physical, bio.emotional, bio.intellectual);

            // ì§„ë‹¨ ì†Œê²¬ (Doctor's Note style)
            if (bio.physical === maxVal && bio.physical > 0) {
                fortuneMsg = "ì‹ ì²´ í™œì„±ë„ê°€ ìµœê³ ì¡°ì…ë‹ˆë‹¤. ë¯¸ë¤„ë’€ë˜ ìš´ë™ì´ë‚˜ í™œë™ì ì¸ ì¼ì„ ì²˜ë¦¬í•˜ê¸°ì— ìµœì ì˜ ì‹œê¸°ì…ë‹ˆë‹¤. ë‹¤ë§Œ ì—ë„ˆì§€ ì†Œë¹„ê°€ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                recommendType = "intellectual"; 
            } else if (bio.emotional === maxVal && bio.emotional > 0) {
                fortuneMsg = "ê°ì„± ì§€ìˆ˜ê°€ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. íƒ€ì¸ê³¼ì˜ êµê°ì´ë‚˜ ì˜ˆìˆ ì  í™œë™ì— ìœ ë¦¬í•˜ì§€ë§Œ, ê°ì • ê¸°ë³µì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                recommendType = "emotional";
            } else if (bio.intellectual === maxVal && bio.intellectual > 0) {
                fortuneMsg = "ì§€ì„± ë¦¬ë“¬ì´ ìƒìŠ¹ì„¸ì…ë‹ˆë‹¤. ì§‘ì¤‘ë ¥ê³¼ íŒë‹¨ë ¥ì´ ì¢‹ì•„ ì¤‘ìš”í•œ ê²°ì •ì„ ë‚´ë¦¬ê¸°ì— ì í•©í•œ í•˜ë£¨ì…ë‹ˆë‹¤.";
                recommendType = "intellectual";
            }
            
            if (maxVal < 0) {
                fortuneMsg = "ì „ë°˜ì ì¸ ìƒì²´ ë¦¬ë“¬ì´ ì €ì¡°ê¸°(Low) êµ¬ê°„ì…ë‹ˆë‹¤. ë¬´ë¦¬í•œ í™œë™ë³´ë‹¤ëŠ” íœ´ì‹ê³¼ ì˜ì–‘ ë³´ì¶©ì´ ì‹œê¸‰í•©ë‹ˆë‹¤.";
                recommendType = "physical"; 
            } else if (bio.emotional < -50) {
                fortuneMsg += " íŠ¹íˆ ê°ì • ì§€ìˆ˜ê°€ ë‚®ì•„ ìŠ¤íŠ¸ë ˆìŠ¤ì— ì·¨ì•½í•  ìˆ˜ ìˆìœ¼ë‹ˆ ë§ˆì¸ë“œ ì»¨íŠ¸ë¡¤ ì²˜ë°©ì´ í•„ìš”í•©ë‹ˆë‹¤.";
                recommendType = "emotional"; 
            } else if (bio.physical < -50) {
                fortuneMsg += " ì‹ ì²´ ì—ë„ˆì§€ê°€ ë°”ë‹¥ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ë¬´ì¡°ê±´ì ì¸ íœ´ì‹ì„ ê¶Œì¥í•©ë‹ˆë‹¤.";
                recommendType = "physical";
            }

            document.getElementById('fortune-text').innerText = fortuneMsg;

            // 3. ìŒì‹ ì¶”ì²œ (ì²˜ë°©)
            const badge = document.getElementById('food-reason-badge');
            
            if (recommendType === "physical") {
                currentFoodList = moodFoods["physical"];
                badge.innerText = "ê¸°ë ¥ íšŒë³µ ì²˜ë°©";
                badge.className = "text-[10px] bg-green-500/30 text-green-100 px-2 py-0.5 rounded-full font-medium";
            } else if (recommendType === "emotional") {
                currentFoodList = moodFoods["emotional"];
                badge.innerText = "ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™” ì²˜ë°©";
                badge.className = "text-[10px] bg-red-500/30 text-red-100 px-2 py-0.5 rounded-full font-medium";
            } else {
                currentFoodList = moodFoods["intellectual"];
                badge.innerText = "ë‘ë‡Œ í™œì„± ì²˜ë°©";
                badge.className = "text-[10px] bg-blue-500/30 text-blue-100 px-2 py-0.5 rounded-full font-medium";
            }

            currentFoodIndex = 0;
            updateFoodUI(currentFoodList[0]);

            // UI ì—…ë°ì´íŠ¸
            const zodiac = getZodiac(birthDate);
            document.getElementById('zodiac-icon').innerText = zodiac.icon;
            document.getElementById('user-greeting').innerText = nameInput ? `${nameInput}ë‹˜` : "í™˜ìë¶„";

            toggleLoading(false);
            document.getElementById('input-section').classList.add('hidden');
            document.getElementById('result-section').classList.remove('hidden');
            lucide.createIcons();
        }

        function updateBar(type, value) {
            const bar = document.getElementById(`bar-${type}`);
            const valText = document.getElementById(`val-${type}`);
            
            const width = Math.max(5, (value + 100) / 2); 
            
            setTimeout(() => {
                bar.style.width = `${width}%`;
                if (value < 0) bar.style.opacity = "0.6";
                else bar.style.opacity = "1";
            }, 100);

            valText.innerText = `${value > 0 ? '+' : ''}${value}`;
            if (value > 0) valText.className = "font-bold text-white";
            else valText.className = "font-bold text-gray-400";
        }

        function updateFoodUI(food) {
            document.getElementById('food-name').innerText = food.name;
            document.getElementById('food-desc').innerText = food.desc;
            document.getElementById('food-map-link').href = "https://map.naver.com/p/search/" + encodeURIComponent(food.query);
        }

        function rerollFood() {
            currentFoodIndex = (currentFoodIndex + 1) % currentFoodList.length;
            updateFoodUI(currentFoodList[currentFoodIndex]);
        }

        function toggleLoading(isLoading) {
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            if (isLoading) {
                btnText.classList.add('hidden');
                btnLoader.classList.remove('hidden');
            } else {
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
            }
        }

        function getZodiac(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dateStr = `${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            if (month === 1 && day <= 19) return zodiacSigns.find(z => z.name === "ì—¼ì†Œìë¦¬");
            for (let z of zodiacSigns) {
                if (dateStr >= z.start && dateStr <= z.end) return z;
            }
            return zodiacSigns.find(z => z.name === "ì—¼ì†Œìë¦¬");
        }

        function shareResult() {
            if (navigator.share) {
                navigator.share({
                    title: 'ìµì‚° ë§›ì§‘ ì²˜ë°©ì „',
                    text: 'ë‹¥í„° ìµì‚°ì˜ ë°”ì´ì˜¤ë¦¬ë“¬ ì§„ë‹¨ ê²°ê³¼ì™€ ë§›ì§‘ ì²˜ë°©ì„ í™•ì¸í•˜ì„¸ìš”!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => alert("ì§„ë‹¨ì„œ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
            }
        }

        function saveAsImage() {
            const captureArea = document.querySelector("#capture-area");
            const saveBtn = document.getElementById('save-btn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = "ì €ì¥ ì¤‘...";
            
            html2canvas(captureArea, {
                scale: 2, backgroundColor: null,
                ignoreElements: (element) => element.classList.contains('no-capture') || element.hasAttribute('data-html2canvas-ignore')
            }).then(canvas => {
                const link = document.createElement("a");
                link.download = "ìµì‚°ë§›ì§‘ì²˜ë°©ì „.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
                saveBtn.innerHTML = originalText;
                lucide.createIcons();
            });
        }

        function resetApp() {
            document.getElementById('input-section').classList.remove('hidden');
            document.getElementById('result-section').classList.add('hidden');
            document.querySelectorAll('.progress-bar').forEach(el => el.style.width = '0%');
        }
    </script>
</body>
</html>
